generator client {
  provider        = "prisma-client-js"
  output          = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}


model User {
  id                  String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                String              @default("NO_NAME")
  email               String              @unique
  password            String?
  emailVerified       DateTime?
  role                Role                @default(PATIENT)
  isRootAdmin         Boolean?            @default(false)
  image               String?
  dateofbirth         DateTime?
  phoneNumber         String?
  address             String?
  isActive            Boolean             @default(true)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  accounts            Account[]
  doctorAppointments  Appointment[]       @relation("DoctorAppointments")
  userAppointments    Appointment[]       @relation("UserAppointments")
  doctorLeaves        DoctorLeave[]
  doctorProfile       DoctorProfile?
  doctorTestimonials  DoctorTestimonial[] @relation("DoctorTestimonials")
  patientTestimonials DoctorTestimonial[] @relation("PatientTestimonials")
  transactions        Transaction[]

  @@map("users")
}

model Account {
  id                String   @id @default(cuid())
  userId            String   @db.Uuid
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model DoctorProfile {
  profileId       String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId          String   @unique @db.Uuid
  specialty       String
  brief           String
  credentials     String
  languages       String[]
  rating          Float    @default(0)
  reviewCount     Int      @default(0)
  specializations String[]
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  doctor          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("doctor_profiles")
}

model DoctorLeave {
  leaveId   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  doctorId  String    @db.Uuid
  leaveDate DateTime  @db.Date
  leaveType LeaveType
  reason    String?
  createdAt DateTime  @default(now())
  doctor    User      @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@unique([doctorId, leaveDate])
  @@map("doctor_leaves")
}

model AppSettings {
  id                      String @id @default("global")
  slotsPerHour            Int    @default(2)
  startTime               String @default("09:00")
  endTime                 String @default("17:00")
  slotReservationDuration Int    @default(10)

  @@map("app_settings")
}

model WorkingDay {
  dayId        String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  dayOfWeek    Int     @unique
  isWorkingDay Boolean @default(true)

  @@map("working_days")
}

model Appointment {
  appointmentId        String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  doctorId             String             @db.Uuid
  userId               String?            @db.Uuid
  guestIdentifier      String?
  patientType          PatientType
  patientRelation      String?
  patientName          String
  paymentMethod        String?
  paymentResult        Json?
  paidAt               DateTime?
  appointmentStartUTC  DateTime
  appointmentEndUTC    DateTime
  phoneNumber          String?
  reasonForVisit       String?
  additionalNotes      String?
  patientdateofbirth   DateTime?
  reservationExpiresAt DateTime?
  status               AppointmentStatus  @default(PAYMENT_PENDING)
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  doctor               User               @relation("DoctorAppointments", fields: [doctorId], references: [id])
  user                 User?              @relation("UserAppointments", fields: [userId], references: [id])
  testimonial          DoctorTestimonial?
  transactions         Transaction[]

  @@map("appointments")
}

model DoctorTestimonial {
  testimonialId   String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  appointmentId   String      @unique @db.Uuid
  doctorId        String      @db.Uuid
  patientId       String      @db.Uuid
  testimonialText String
  rating          Float?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  appointment     Appointment @relation(fields: [appointmentId], references: [appointmentId], onDelete: Cascade)
  doctor          User        @relation("DoctorTestimonials", fields: [doctorId], references: [id])
  patient         User        @relation("PatientTestimonials", fields: [patientId], references: [id])

  @@map("doctor_testimonials")
}

model Transaction {
  id                   String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  appointmentId        String            @db.Uuid
  doctorId             String            @db.Uuid
  paymentGateway       String
  gatewayTransactionId String            @unique
  amount               Float
  currency             String
  status               TransactionStatus
  transactionDate      DateTime          @default(now())
  notes                String?
  paymentDetails       Json?
  appointment          Appointment       @relation(fields: [appointmentId], references: [appointmentId], onDelete: Cascade)
  doctor               User              @relation(fields: [doctorId], references: [id])

  @@map("transactions")
}

model BannerImage {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String
  imageUrl  String
  fileKey   String   @unique
  order     Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("banner_images")
}

model Department {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String   @unique
  iconName  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("departments")
}

enum Role {
  PATIENT
  DOCTOR
  ADMIN
}

enum LeaveType {
  FULL_DAY
  MORNING
  AFTERNOON
}

enum PatientType {
  MYSELF
  SOMEONE_ELSE
}

enum AppointmentStatus {
  PAYMENT_PENDING
  BOOKING_CONFIRMED
  COMPLETED
  CANCELLED
  NO_SHOW
  CASH
}

enum TransactionStatus {
  COMPLETED
  FAILED
  CANCELLED
}
